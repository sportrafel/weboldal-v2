---
// src/pages/galeria.astro
import Layout from "../layouts/Layout.astro";
import ContextAlert from "../components/ContextAlert.astro";

// Adatok (cseréld sajátodra): képek a /public/assets alá
const items = [
  { type: "video", yt: "dQw4w9WgXcQ", title: "Minta videó címe", desc: "Rövid leírás a videóról.", wide: true },
  { type: "image", src: "/assets/photo-1.jpg", large: "/assets/photo-1-large.jpg", title: "Naplemente a hegyekben", desc: "Saját leírás, CC‑0/stock jelölés." },
  { type: "video", yt: "ysz5S6PUM-U", title: "Rövid tutorial", desc: "Reszponzív beágyazás aspect‑ratio-val." },
  { type: "image", src: "/assets/photo-2.jpg", large: "/assets/photo-2-large.jpg", title: "Őszi levelek", desc: "Alt szöveg + leírás SEO‑hoz." },
];
---

<Layout title="Galéria – képek és YouTube videók">
  <ContextAlert class="mb-8" />

  <h1 class="mb-3">Galéria</h1>
  <p class="text-muted-foreground mb-8 max-w-3xl">
    Képek és YouTube‑videók egy helyen. Reszponzív, gyors, SEO‑barát. A képeket a
    <code class="px-1 py-0.5 rounded bg-muted">/public/assets</code> mappából szolgáljuk ki.
  </p>

  <!-- Szűrők -->
  <div class="mb-6 flex flex-wrap gap-2" role="toolbar" aria-label="Szűrők">
    <button class="btn" data-filter="all" aria-pressed="true">Összes</button>
    <button class="btn" data-filter="image" aria-pressed="false">Képek</button>
    <button class="btn" data-filter="video" aria-pressed="false">Videók</button>
  </div>

  <!-- Rács -->
  <section id="gallery" class="grid grid-cols-12 gap-4 sm:gap-5">
    {items.map((it) => (
      <article class={`col-span-12 sm:col-span-6 lg:col-span-4 ${it.wide ? "lg:col-span-6" : ""} card overflow-hidden`}
               data-type={it.type}>
        {it.type === "video" ? (
          <div class="relative aspect-video bg-card/30" data-yt-id={it.yt} aria-label="YouTube lejátszó"></div>
        ) : (
          <button class="relative aspect-video bg-card/30" data-lightbox-src={it.large} aria-label="Kép megnyitása nagyban">
            <img src={it.src} alt={it.title} loading="lazy" class="absolute inset-0 h-full w-full object-cover" width="1280" height="720" />
          </button>
        )}
        <div class="p-3 border-t">
          <div class="mb-1 flex items-center gap-2 text-xs">
            <span class="badge">{it.type === "video" ? "YouTube" : "Fotó"}</span>
          </div>
          <h3 class="font-semibold leading-tight">{it.title}</h3>
          <p class="text-sm text-muted-foreground mt-1">{it.desc}</p>
        </div>
      </article>
    ))}
  </section>

  <!-- Lightbox -->
  <dialog id="lightbox" class="rounded-xl max-w-[1100px] w-[92vw] backdrop:bg-black/60">
    <div class="flex items-center justify-between gap-4 px-3 py-2 border-b">
      <span id="lb-title" class="text-sm font-medium">Megnyitott kép</span>
      <button id="lb-close" class="btn btn-sm" aria-label="Bezárás">Bezár</button>
    </div>
    <img id="lb-img" alt="Nagyított kép" class="w-full h-auto" />
  </dialog>

  <script is:inline>
    // YouTube (privacy‑enhanced) – csak iframe, amikor a DOM kész
    const ytDivs = document.querySelectorAll('.relative.aspect-video[data-yt-id]');
    ytDivs.forEach((el) => {
      const id = el.getAttribute('data-yt-id');
      const iframe = document.createElement('iframe');
      iframe.setAttribute('allowfullscreen', '');
      iframe.setAttribute('loading', 'lazy');
      iframe.setAttribute('referrerpolicy', 'strict-origin-when-cross-origin');
      iframe.className = 'absolute inset-0 w-full h-full';
      iframe.src = `https://www.youtube-nocookie.com/embed/${id}`;
      el.appendChild(iframe);
    });

    // Lightbox
    const dlg = document.getElementById('lightbox');
    const lbImg = document.getElementById('lb-img');
    const lbTitle = document.getElementById('lb-title');
    const closeBtn = document.getElementById('lb-close');

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[data-lightbox-src]');
      if (btn) {
        const src = btn.getAttribute('data-lightbox-src');
        const card = btn.closest('article');
        const title = card?.querySelector('h3')?.textContent?.trim() || 'Kép';
        lbImg.src = src;
        lbImg.alt = title;
        lbTitle.textContent = title;
        dlg.showModal();
      }
    });
    closeBtn?.addEventListener('click', () => dlg.close());
    dlg?.addEventListener('click', (e) => { if (e.target === dlg) dlg.close(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && dlg.open) dlg.close(); });

    // Szűrés gombok
    const toolbarBtns = document.querySelectorAll('[role="toolbar"] .btn');
    const gallery = document.getElementById('gallery');
    toolbarBtns.forEach((b) => b.addEventListener('click', () => {
      toolbarBtns.forEach((x) => x.setAttribute('aria-pressed', 'false'));
      b.setAttribute('aria-pressed', 'true');
      const filter = b.dataset.filter;
      [...gallery.children].forEach((card) => {
        const type = card.getAttribute('data-type');
        const show = filter === 'all' || filter === type;
        card.style.display = show ? '' : 'none';
      });
    }));
  </script>

  <style is:global>
    /* Finom igazítások, a Layout/Tailwind stílusait követve */
    .card { @apply rounded-2xl border bg-card text-card-foreground shadow-sm transition hover:shadow-md; }
    .badge { @apply inline-flex items-center rounded-full border px-2 py-0.5 text-[11px] font-medium; }
  </style>
</Layout>
